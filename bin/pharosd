#!/usr/bin/python
import sys
import logging

import tornado.httpserver
import tornado.ioloop

import pharos

if __name__ == '__main__':

    logging.basicConfig(level=logging.DEBUG, stream=sys.stdout)
    
    application = tornado.web.Application([
        (r"/", pharos.MainHandler),
    ], debug=True)

    http_server = tornado.httpserver.HTTPServer(application)
    http_server.listen(8888)

    io_loop = tornado.ioloop.IOLoop.instance()

    execfile("docs/config.py")

    # We're just going to stuff this variable into our application even though tornado knows nothing about it
    # Allows us to avoid nasty global
    setattr(application, "metric_watchers", list())

    application.metric_watchers += metric_watchers
    
    for watcher in metric_watchers:
        watcher.add_to_loop(io_loop)

    # Let's get it started!
    io_loop.start()
